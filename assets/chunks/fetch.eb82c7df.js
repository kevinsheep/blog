import{a as m}from"./axios.67252f11.js";import{n as h}from"./index.5f2eae9a.js";const a="kevinsheep",n="blog",_="Iv1.c81fcafbda51d6d6",f="https://github.com/",w="https://api.github.com/",$="https://ceil.top/login.html",d="https://api.ceil.top:8000",o=m.create({baseURL:w}),b="REDIRECT_PAGE",c="TOKEN_DATA",p=(t,s="{}")=>JSON.parse(window.localStorage.getItem(t)||s),l=(t,s)=>{window.localStorage.setItem(t,JSON.stringify(s))},u=t=>{window.localStorage.removeItem(t)},y=()=>(u(c),`${f}login/oauth/authorize?client_id=${_}&redirect_uri=${$}`),T=async t=>{const e=await o({method:"post",url:d,data:{code:t}});return e.data&&e.data.access_token&&l(c,e.data),e.data},k=async t=>{const e=await o({method:"post",url:d,params:{grant_type:"refresh_token",refresh_token:t}});return e.data.access_token&&l(c,e.data),e.data},I=async t=>{const s=`/repos/${a}/${n}/issues${t?"/"+t:""}`;return await o({url:s,method:"get",params:{}})};o.interceptors.request.use(t=>{const{access_token:s}=p(c);return s&&(t.headers={Authorization:`Bearer ${s}`,accept:"application/vnd.github+json"}),t});o.interceptors.response.use(t=>t,async t=>{var s,e;if(console.log(t.response),[401].includes((s=t==null?void 0:t.response)==null?void 0:s.status))if(console.log(t.config),((e=t.config)==null?void 0:e.params.grant_type)==="refresh_token")u(c),location.href=y();else{const{refresh_token:r}=p(c);if((await k(r)).access_token)return await o(t.config);console.log("The code passed is incorrect or expired.")}else h("github 失联了，请稍后再试"),location.href="/index",Promise.reject(t)});const R=async t=>{const s=`/repos/${a}/${n}/issues/${t}/comments`;return await o({url:s,method:"get",params:{}})},v=async(t,s)=>{const e=a,r=n,i=`/repos/${a}/${n}/issues/${t}/comments`;return await o({url:i,method:"post",data:{owner:e,repo:r,issue_number:t,body:s}})},A=async(t,s)=>{const e=a,r=n,i=["blog"],g=`/repos/${a}/${n}/issues`;return await o({url:g,method:"post",data:{owner:e,repo:r,title:t,labels:i,body:s}})};export{b as R,c as T,p as a,I as b,R as c,v as d,A as e,T as g,y as l,l as s};
