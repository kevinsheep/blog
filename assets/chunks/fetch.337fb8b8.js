import{a as m}from"./axios.47b9d439.js";import{a as p,r as d,n as g,s as u}from"./index.a091b4b7.js";const a="kevinsheep",n="blog",_="Iv1.c81fcafbda51d6d6",f="https://github.com/",$="https://api.github.com/",k="https://ceil.top/login.html",l="https://api.ceil.top:8000",o=m.create({baseURL:$}),T="REDIRECT_PAGE",c="TOKEN_DATA",y=()=>(d(c),`${f}login/oauth/authorize?client_id=${_}&redirect_uri=${k}`),R=async s=>{const e=await o({method:"post",url:l,data:{code:s}});return e.data&&e.data.access_token&&u(c,e.data),e.data},E=async s=>{const e=await o({method:"post",url:l,params:{grant_type:"refresh_token",refresh_token:s}});return e.data.access_token&&u(c,e.data),e.data},A=async s=>{const t=`/repos/${a}/${n}/issues${s?"/"+s:""}`;return await o({url:t,method:"get",params:{}})};o.interceptors.request.use(s=>{const{access_token:t}=p(c);return t&&(s.headers={Authorization:`Bearer ${t}`,accept:"application/vnd.github+json"}),s});o.interceptors.response.use(s=>s,async s=>{var t,e;if(console.log(s.response),[401].includes((t=s==null?void 0:s.response)==null?void 0:t.status))if(console.log(s.config),((e=s.config)==null?void 0:e.params.grant_type)==="refresh_token")d(c),location.href=y();else{const{refresh_token:i}=p(c);if((await E(i)).access_token)return await o(s.config);console.log("The code passed is incorrect or expired.")}else g("github 失联了，请稍后再试"),location.href="/index",Promise.reject(s)});const v=async s=>{const t=`/repos/${a}/${n}/issues/${s}/comments`;return await o({url:t,method:"get",params:{}})},x=async(s,t)=>{const e=a,i=n,r=`/repos/${a}/${n}/issues/${s}/comments`;return await o({url:r,method:"post",data:{owner:e,repo:i,issue_number:s,body:t}})},I=async(s,t)=>{const e=a,i=n,r=["blog"],h=`/repos/${a}/${n}/issues`;return await o({url:h,method:"post",data:{owner:e,repo:i,title:s,labels:r,body:t}})};export{T as R,c as T,A as a,v as b,x as c,I as d,R as g,y as l};
